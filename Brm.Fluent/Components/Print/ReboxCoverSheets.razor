@page "/coversheets/{BoxNo}"
@layout PrintLayout

@inject BRMDbService db
@inject BarCodeService bcService
@inject IJSRuntime Js

<header>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</header>
<div>
    <button class="btn btn-primary active" @onclick="btnBack_Click">Back</button>
    <button class="btn btn-primary active" @onclick="btnPrint_Click">Print</button>
</div>
@if(sheets == null)
{
    <p>Loading...</p>
}
else
{
    @foreach (var file in sheets)
    {
        <FileCoverSheet BrmBarCode="@file.BrmNo"></FileCoverSheet>
    }
}




@code {


    [Parameter]
    public string? BoxNo { get; set; }

    public List<ReboxListItem>? sheets;

    protected override async Task OnInitializedAsync()
    {
        if(BoxNo != null)sheets = await db.GetAllFilesByBoxNo(BoxNo);
    }

    private async Task btnPrint_Click()
    {

        await Js.InvokeVoidAsync("printPage");
    }

    private void btnBack_Click()
    {
        Js.InvokeVoidAsync("window.close");
    }
    protected override Task OnAfterRenderAsync(bool firstRender)
    {
        Task.Delay(20);
        StateHasChanged();
        return base.OnAfterRenderAsync(firstRender);
    }

}
