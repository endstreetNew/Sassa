@using Microsoft.Extensions.Configuration

@inject SessionService sessionservice
@inject StaticService staticservice
@inject IConfiguration config



<div class="navmenu" >
    <input type="checkbox" title="Menu expand/collapse toggle" id="navmenu-toggle" class="navmenu-icon" />
    <label for="navmenu-toggle" class="navmenu-icon"><FluentIcon Value="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.Navigation())" Color="Color.Fill" /></label>
    <nav class="sitenav" aria-labelledby="main-menu">
        <FluentNavMenu Id="main-menu" Collapsible="true" Width="250" Title="Navigation menu" @bind-Expanded="@expanded" CustomToggle="true">
            <FluentNavLink Href="/" Match="NavLinkMatch.All" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.Home())" IconColor="Color.Accent">Home</FluentNavLink>
            <FluentNavLink Href="searchapplicant" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.ChannelAdd())" IconColor="Color.Accent">File Capture</FluentNavLink>
            <FluentNavLink Href="enquirypage" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.Search())" IconColor="Color.Accent">Enquiry</FluentNavLink>
            <FluentNavLink Href="http://10.124.154.88/sassaongoing/ValidationLogin.aspx" Target="_blank" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.BarcodeScanner())" IconColor="Color.Accent">Scan</FluentNavLink>
            <FluentNavLink Href="@RsWeb" Target="_blank" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.BuildingSwap())" IconColor="Color.Accent">RSWeb</FluentNavLink>
            <FluentNavLink Href="misfiles" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.DocumentTableSearch())" IconColor="Color.Accent">MIS Files</FluentNavLink>
            <FluentNavLink Href="boxing" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.Box())" IconColor="Color.Accent">@(sessionservice.session.IsRmc() ? "Re-boxing" : "Batching")</FluentNavLink>
            <FluentNavLink Href="reportpage" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.DocumentPrint())" IconColor="Color.Accent">Reports</FluentNavLink>
            <FluentNavLink Href="filerequest" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.DocumentArrowLeft())" IconColor="Color.Accent">File Requests </FluentNavLink>
            @if (sessionservice.session.IsRmc())
            {
                <FluentNavLink Href="destruction" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.DeleteLines())" IconColor="Color.Accent">Destruction</FluentNavLink>
                @if (sessionservice.session.IsInRole("GRP_BRM_Office_Name_Change"))
                {
                    <FluentNavLink Href="officeadmin" Icon="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.CheckboxPerson())" IconColor="Color.Accent">Office Admin</FluentNavLink>
                }
            }
        </FluentNavMenu>
    </nav>
</div>

@code {
    //private PostMessage _message = new PostMessage();
    //private User? user;
    string RsWeb = "";
    bool expanded = true;
    protected override void OnInitialized()
    {
        RsWeb = config.GetValue<string>("Urls:RsWeb")!;
        sessionservice.UserOfficeChanged += new EventHandler(OnUserOfficeChanged);
        // if(sessionservice.session.IsLoggedIn())
        // {
        //     user = new User(sessionservice.session.SamName);
        //     autoLoginService.Login(user);
        //     StateHasChanged();
        // }

    }
    private void OnUserOfficeChanged(object? sender, EventArgs args)
    {
        StateHasChanged();
    }

    public void Dispose()
    {
        sessionservice.UserOfficeChanged -= new EventHandler(OnUserOfficeChanged);
    }

}