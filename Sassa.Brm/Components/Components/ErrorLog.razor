@using System.IO
@inject IWebHostEnvironment Env

<WidgetTitle Title="Error Log Viewer" Loading="loading"/>

@if (!loading)
{
    if (!logLines.Any())
    {
        <p>No error log found or log is empty.</p>
    }
    else
    {
        <div style="max-height:600px;overflow:auto;font-family:monospace;background:#222;color:#eee;padding:1em;">
            @foreach (var line in logLines)
            {
                <div>@line</div>
            }
        </div>
    }
}

@code {
    private List<string> logLines = new();
    private bool loading = true;

    protected override void OnInitialized()
    {
        // Adjust the path to match log file location
        var logPath = Path.Combine(Env.ContentRootPath, "Logs", $"app-Brm-Error{DateTime.Today.AddDays(-1).ToString("yyyyMMdd")}.log");

        if (File.Exists(logPath))
        {
            using (var fs = new FileStream(logPath, FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
            using (var sr = new StreamReader(fs))
            {
                string? line;
                while ((line = sr.ReadLine()) != null)
                {
                    logLines.Add(line);
                }
            }
        }
        loading = false;
    }
}